<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no, viewport-fit=cover">
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="theme-color" content="#1e1e1e">
  <title>Shot Designer</title>
  <link rel="manifest" href="manifest.json">
  <link rel="apple-touch-icon" href="icons/icon-192.png">
  <link rel="stylesheet" href="css/app.css">
</head>
<body>
  <!-- Top Bar -->
  <header id="top-bar">
    <div class="top-left">
      <span class="app-name">Shot Designer</span>
    </div>
    <div class="top-center">
      <button id="btn-undo" class="icon-btn" title="Undo" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M3 10h13a4 4 0 0 1 0 8H7"/><path d="M3 10l4-4M3 10l4 4"/></svg>
      </button>
      <button id="btn-redo" class="icon-btn" title="Redo" disabled>
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 10H8a4 4 0 0 0 0 8h9"/><path d="M21 10l-4-4M21 10l-4 4"/></svg>
      </button>
    </div>
    <div class="top-right">
      <button id="btn-new-project" class="icon-btn" title="New Project">
        <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/><line x1="12" y1="11" x2="12" y2="17"/><line x1="9" y1="14" x2="15" y2="14"/></svg>
        <span>New</span>
      </button>
      <div class="dropdown" id="export-dropdown">
        <button id="btn-export" class="icon-btn" title="Export">
          <svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M21 15v4a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2v-4"/><polyline points="7 10 12 15 17 10"/><line x1="12" y1="15" x2="12" y2="3"/></svg>
          <span>Export</span>
        </button>
        <div class="dropdown-menu">
          <button id="export-scriptation">Share to Scriptation</button>
          <button id="export-png">Export PNG</button>
          <button id="export-pdf">Export PDF</button>
        </div>
      </div>
    </div>
  </header>

  <!-- Main Content Area -->
  <div id="main">
    <!-- Left Toolbar -->
    <aside id="toolbar">
      <button class="tool-btn active" data-tool="select" title="Select">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="currentColor"><path d="M4 2l12 16-4.4-1.6L8 22l-1.2-3.6L2 18z"/></svg>
      </button>
      <button class="tool-btn" data-tool="actor" title="Actor">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><circle cx="12" cy="8" r="4"/><path d="M6 20v-2a4 4 0 0 1 8 0v2"/></svg>
      </button>
      <button class="tool-btn" data-tool="actor-arrow" title="Actor Movement">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 19Q12 5 19 12" stroke-dasharray="3 2"/><polygon points="19 12 14 10 16 15" fill="currentColor"/><circle cx="6" cy="18" r="4"/></svg>
      </button>
      <button class="tool-btn" data-tool="camera" title="Camera">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><rect x="2" y="6" width="15" height="12" rx="2"/><polygon points="22 8 17 12 22 16"/></svg>
      </button>
      <button class="tool-btn" data-tool="camera-arrow" title="Camera Movement">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M5 19Q12 5 19 12"/><polygon points="19 12 14 10 16 15" fill="currentColor"/><rect x="4" y="15" width="7" height="5" rx="1"/></svg>
      </button>
      <div style="position:relative">
        <button class="tool-btn" data-tool="text" title="Text">
          <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="4 7 4 4 20 4 20 7"/><line x1="9.5" y1="4" x2="9.5" y2="20"/><line x1="14.5" y1="4" x2="14.5" y2="20"/><line x1="7" y1="20" x2="17" y2="20"/></svg>
        </button>
        <!-- Text config popover -->
        <div id="text-popover" class="tool-popover hidden">
          <div class="popover-section">
            <label class="popover-label">Color</label>
            <div class="popover-swatches" id="text-config-colors">
              <div class="popover-swatch selected" style="background:#ffffff;border:1px solid #666" data-color="#ffffff"></div>
              <div class="popover-swatch" style="background:#e74c3c" data-color="#e74c3c"></div>
              <div class="popover-swatch" style="background:#3498db" data-color="#3498db"></div>
              <div class="popover-swatch" style="background:#2ecc71" data-color="#2ecc71"></div>
              <div class="popover-swatch" style="background:#f1c40f" data-color="#f1c40f"></div>
              <div class="popover-swatch" style="background:#e67e22" data-color="#e67e22"></div>
              <div class="popover-swatch" style="background:#9b59b6" data-color="#9b59b6"></div>
              <div class="popover-swatch" style="background:#000000" data-color="#000000"></div>
            </div>
          </div>
        </div>
      </div>
      <div class="tool-divider"></div>
      <button class="tool-btn" id="btn-load-plan" title="Load Floor Plan">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><path d="M14 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V8z"/><polyline points="14 2 14 8 20 8"/></svg>
      </button>
      <button class="tool-btn" id="btn-delete" title="Delete Selected">
        <svg width="22" height="22" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><polyline points="3 6 5 6 21 6"/><path d="M19 6l-1 14a2 2 0 0 1-2 2H8a2 2 0 0 1-2-2L5 6"/><path d="M10 11v6M14 11v6"/><path d="M9 6V4a1 1 0 0 1 1-1h4a1 1 0 0 1 1 1v2"/></svg>
      </button>
    </aside>

    <!-- Canvas Wrapper -->
    <div id="canvas-wrapper">
      <canvas id="main-canvas"></canvas>
    </div>

    <!-- Right Sidebar (always visible) -->
    <aside id="right-sidebar">
      <div id="sidebar-resize-handle"></div>
      <!-- Properties Section (shown when editing an object) -->
      <div id="properties-section" class="hidden">
        <div class="panel-header">
          <span>Properties</span>
          <button id="btn-close-panel" class="icon-btn">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="18" y1="6" x2="6" y2="18"/><line x1="6" y1="6" x2="18" y2="18"/></svg>
          </button>
        </div>
        <div id="panel-content">
          <!-- Dynamic content inserted by JS -->
        </div>
      </div>

      <!-- Character Roster Section (always visible) -->
      <div id="roster-section">
        <div class="panel-header">
          <div class="roster-type-toggle" id="roster-type-toggle">
            <button class="roster-type-btn active" data-type="actor">Actor</button>
            <button class="roster-type-btn" data-type="camera">Camera</button>
          </div>
          <button id="btn-add-character" class="icon-btn" title="Add Character">
            <svg width="16" height="16" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2"><line x1="12" y1="5" x2="12" y2="19"/><line x1="5" y1="12" x2="19" y2="12"/></svg>
          </button>
        </div>

        <!-- Inline add form (hidden by default) -->
        <div id="roster-form" class="hidden">
          <div class="roster-form-inner">
            <div class="prop-group">
              <label class="prop-label">Name</label>
              <input type="text" class="prop-input" id="roster-name" placeholder="e.g. Detective Morgan" maxlength="30">
            </div>
            <div class="prop-group">
              <label class="prop-label">Label (on icon)</label>
              <input type="text" class="prop-input" id="roster-label" placeholder="e.g. DM" maxlength="4">
            </div>
            <div class="prop-group">
              <label class="prop-label">Color</label>
              <div class="popover-swatches" id="roster-colors">
                <!-- Rendered by JS -->
              </div>
            </div>
            <div class="roster-form-actions">
              <button id="roster-save" class="roster-btn roster-btn-primary">Save</button>
              <button id="roster-cancel" class="roster-btn">Cancel</button>
            </div>
          </div>
        </div>

        <!-- Character list -->
        <div id="roster-list">
          <!-- Dynamically rendered -->
        </div>

        <!-- Empty state -->
        <div id="roster-empty">
          <p>No characters yet.</p>
          <p>Tap + to create one.</p>
        </div>
      </div>
    </aside>
  </div>

  <!-- Status Bar -->
  <footer id="status-bar">
    <div class="status-left">
      <span id="zoom-display">100%</span>
      <button id="btn-fit" class="status-btn" title="Fit to screen">Fit</button>
      <button id="btn-rotate" class="status-btn" title="Rotate plan 90Â°">
        <svg width="14" height="14" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2.5"><path d="M1 4v6h6"/><path d="M3.51 15a9 9 0 1 0 2.13-9.36L1 10"/></svg>
      </button>
    </div>
    <div class="status-center">
      <span id="page-indicator" class="hidden">Page <span id="page-current">1</span> / <span id="page-total">1</span></span>
      <button id="btn-prev-page" class="status-btn hidden" title="Previous page">&lt;</button>
      <button id="btn-next-page" class="status-btn hidden" title="Next page">&gt;</button>
    </div>
    <div class="status-right">
      <span id="status-message"></span>
    </div>
  </footer>

  <!-- New Project Confirmation Modal -->
  <div id="new-project-modal" class="modal-overlay hidden">
    <div class="modal-box">
      <p class="modal-message">Would you like to export your current project before starting a new one?</p>
      <div class="modal-actions">
        <button id="modal-export-first" class="modal-btn modal-btn-primary">Export First</button>
        <button id="modal-new" class="modal-btn modal-btn-danger">New Project</button>
        <button id="modal-cancel" class="modal-btn">Cancel</button>
      </div>
    </div>
  </div>

  <!-- Hidden file input for loading plans -->
  <input type="file" id="file-input" accept=".pdf,.png,.jpg,.jpeg" hidden>

  <!-- CDN Scripts -->
  <script src="https://cdn.jsdelivr.net/npm/fabric@6.0.2/dist/index.min.js"></script>
  <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.2/jspdf.umd.min.js"></script>

  <!-- App Scripts (ES Modules) -->
  <script type="module" src="js/app.js"></script>
</body>
</html>
